<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UNEB Automatic Subject Summary System</title>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --primary:#1e40af;
      --secondary:#0ea5e9;
      --bg:#f1f5f9;
      --card:#ffffff;
      --text:#0f172a;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    main {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }

    h1,h2,h3,h4 { margin-top: 0; }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 6px 15px rgba(0,0,0,.08);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px,1fr));
      gap: 15px;
    }

    input, button {
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #cbd5f5;
      width: 100%;
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background .3s;
    }

    button:hover { background:#1e3a8a; }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #e2e8f0;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #e0e7ff;
      font-weight: bold;
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #64748b;
      font-size: 13px;
    }
  </style>
</head>
<body>

<header>
  <h1>UNEB Automatic Subject Summary</h1>
  <p>Smart grading & performance analysis</p>
</header>

<main>

  <div class="card">
    <h2>School Information</h2>
    <div class="grid">
      <input id="school" placeholder="School Name" />
      <input id="year" placeholder="Year (e.g. 2025)" />
    </div>
  </div>

  <div class="card">
    <h2>Upload Results (Sheet1)</h2>
    <input type="file" id="file" accept=".xlsx" />
    <br><br>
    <button onclick="generateReport()">Generate UNEB Report</button>
  </div>

  <div class="card" id="summary"></div>
  <div class="card" id="genderSummary"></div>

</main>

<footer>
  © UNEB Results Automation System
</footer>

<script>
let summaryData = {};
let genderData = {};

const GRADES = ['A','B','C','D','E','X'];

function generateReport() {
  const fileInput = document.getElementById('file');
  if (!fileInput.files.length) return alert('Upload Excel file first');

  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result, { type: 'binary' });
    const ws = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
    processRows(rows);
  };
  reader.readAsBinaryString(fileInput.files[0]);
}

function processRows(rows) {
  const headers = rows[0].map(h => h.toString().toUpperCase());
  const subjIdx = headers.findIndex(h => h.includes('SUBJECT'));
  const sexIdx  = headers.findIndex(h => h === 'SEX');

  summaryData = {};
  genderData = {};

  for (let i = 1; i < rows.length; i++) {
    const sex = (rows[i][sexIdx] || '').toString().toUpperCase();
    const achievements = rows[i][subjIdx] || '';

    achievements.toString().split(' ').forEach(item => {
      const [sub, grade] = item.split('-');
      if (!sub) return;
      const g = grade || 'X';

      if (!summaryData[sub]) {
        summaryData[sub] = { TOTAL:0 };
        GRADES.forEach(gr => summaryData[sub][gr] = 0);
      }

      summaryData[sub][g]++;

      if (!genderData[sub]) {
        genderData[sub] = {};
        GRADES.forEach(gr => genderData[sub][gr] = { M:0, F:0 });
      }

      if (genderData[sub][g] && genderData[sub][g][sex] !== undefined) {
        genderData[sub][g][sex]++;
      }
    });
  }

  renderSummary();
  renderGenderSummary();
}

function renderSummary() {
  const school = document.getElementById('school').value || 'SCHOOL NAME';
  const year = document.getElementById('year').value || 'YEAR';

  let html = `<h2>${school}</h2><p><strong>UNEB Subject Summary – ${year}</strong></p>`;
  html += '<table><tr><th>S/NO</th><th>SUBJECT</th><th>LEARNERS SAT</th>';
  GRADES.forEach(g => html += `<th>${g}</th><th>%${g}</th>`);
  html += '</tr>';

  let i = 1;
  for (const sub in summaryData) {
    const s = summaryData[sub];
    const total = GRADES.reduce((t,g)=>t+s[g],0);
    html += `<tr><td>${i++}</td><td>${sub}</td><td>${total}</td>`;
    GRADES.forEach(g => html += `<td>${s[g]}</td><td>${total?((s[g]/total)*100).toFixed(1):0}</td>`);
    html += '</tr>';
  }

  html += '</table>';
  document.getElementById('summary').innerHTML = html;
}

function renderGenderSummary() {
  let html = '<h3>Gender Performance Summary</h3>';
  for (const sub in genderData) {
    html += `<h4>${sub}</h4>`;
    html += '<table><tr><th>GRADE</th><th>MALE</th><th>FEMALE</th></tr>';
    GRADES.forEach(g => html += `<tr><td>${g}</td><td>${genderData[sub][g].M}</td><td>${genderData[sub][g].F}</td></tr>`);
    html += '</table>';
  }
  document.getElementById('genderSummary').innerHTML = html;
}
</script>

</body>
</html>

